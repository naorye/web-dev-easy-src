define(["jQuery","Backbone"],function(c,d){if(d.Cache){return d.Cache}d.Cache=function(){this.store={}};c.extend(d.Cache.prototype,d.Events,{set:function(e,f){this.trigger("set",e,f);this.store[e]=f},has:function(e){var f=!!this.store[e];this.trigger("has",e,f);return f},get:function(e){var f=this.store[e];this.trigger("get",e,f);return f},remove:function(e){var f=this.store[e];this.trigger("remove",e,f);delete this.store[e];return f},clear:function(){this.trigger("clear");this.store={}}});var a=d.Model.prototype.fetch,b=d.Collection.prototype.fetch;d.Collection.prototype.fetch=function(e){if(this.cacheKey&&this.cacheObject){var f=this.cacheObject,i=this.cacheKey;if(f.has(i)){var h=f.get(i),j=e.update?"update":"reset";this[j](h,e);if(e.success){e.success(this,h,e)}return c.Deferred().resolve()}else{var g=e.success;e.success=function(k,m,l){f.set(i,m);if(g){g(k,m,l)}};return b.call(this,e)}}else{return b.call(this,e)}};d.Model.prototype.fetch=function(e){if(this.cacheKey&&this.cacheObject){e=e||{};var f=this.cacheObject,i=this.cacheKey,h=e.success;if(f.has(i)){var g=f.get(i);this.set(this.parse(g,e),e);if(h){h(this,g,e)}return c.Deferred().resolve()}else{e.success=function(j,l,k){f.set(i,l);if(h){h(j,l,k)}};return a.call(this,e)}}else{return a.call(this,e)}};return d.Cache});